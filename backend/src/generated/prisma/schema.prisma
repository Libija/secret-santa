generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  EMPLOYEE
}

enum SessionMode {
  OPTIMAL
  NAIVE
}

model User {
  id           Int     @id @default(autoincrement())
  email        String  @unique
  passwordHash String
  firstName    String
  lastName     String
  role         Role    @default(EMPLOYEE)
  isActive     Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ADMIN: sesije koje je kreirao
  sessionsCreated SecretSantaSession[] @relation("SessionsCreatedBy")

  // PAROVI
  givenPairs    Pair[] @relation("PairsGiver")
  receivedPairs Pair[] @relation("PairsReceiver")

  // NAIVE RESULT â€“ sessioni gdje je ostao unmatched
  unmatchedSessions UnmatchedUser[]
}

model SecretSantaSession {
  id              Int         @id @default(autoincrement())
  createdAt       DateTime    @default(now())
  createdByUserId Int
  mode            SessionMode

  createdByUser User @relation("SessionsCreatedBy", fields: [createdByUserId], references: [id])

  pairs          Pair[]
  unmatchedUsers UnmatchedUser[]
}

model Pair {
  id         Int @id @default(autoincrement())
  sessionId  Int
  giverId    Int
  receiverId Int

  session SecretSantaSession @relation(fields: [sessionId], references: [id])

  giver    User @relation("PairsGiver", fields: [giverId], references: [id])
  receiver User @relation("PairsReceiver", fields: [receiverId], references: [id])
}

model UnmatchedUser {
  id        Int @id @default(autoincrement())
  sessionId Int
  userId    Int

  session SecretSantaSession @relation(fields: [sessionId], references: [id])
  user    User               @relation(fields: [userId], references: [id])

  @@unique([sessionId, userId])
}
